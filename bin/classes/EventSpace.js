"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const EventLevel_1 = require("./EventLevel");
class EventSpace {
    constructor() {
        this._eventLevel = new EventLevel_1.EventLevel();
        this.receive = (eventName, listener) => {
            this._eventLevel
                .getChild(EventSpace.convertEventNameType(eventName), true)
                .receivers.add(listener);
            return listener;
        };
        this.on = this.receive;
        this.receiveOnce = (eventName, listener) => {
            const level = this._eventLevel.getChild(EventSpace.convertEventNameType(eventName), true);
            level.receivers.add(function once(data) {
                listener(data);
                level.receivers.delete(once);
            });
            return listener;
        };
        this.once = this.receiveOnce;
        this.off = this.cancel;
        this.send = this.trigger;
    }
    /**
     * 将事件名转换成数组的形式
     * @param eventName 事件名称
     */
    static convertEventNameType(eventName) {
        return 'string' === typeof eventName ? eventName.split('.') : eventName;
    }
    cancel(eventName = [], lrc = true) {
        const level = this._eventLevel.getChild(EventSpace.convertEventNameType(eventName), false);
        if (level !== undefined) {
            if (lrc === true) {
                level.receivers.clear();
                level.children.clear();
            }
            else if (lrc === false) {
                level.receivers.clear();
            }
            else {
                level.receivers.delete(lrc);
            }
        }
    }
    trigger(eventName, data, includeChildren = true, asynchronous) {
        const level = this._eventLevel.getChild(EventSpace.convertEventNameType(eventName), false);
        if (level !== undefined) {
            level.receivers.forEach(item => asynchronous ? setTimeout(item, 0, data) : item(data));
            if (includeChildren) {
                function triggerChildren(level) {
                    level.receivers.forEach(item => asynchronous ? setTimeout(item, 0, data) : item(data));
                    level.children.forEach(triggerChildren);
                }
                level.children.forEach(triggerChildren);
            }
        }
    }
    has(eventName, lrc = true) {
        const level = this._eventLevel.getChild(EventSpace.convertEventNameType(eventName), false);
        if (level === undefined) {
            return false;
        }
        else {
            if (lrc === true) {
                function checkChildren(level) {
                    if (level.receivers.size > 0)
                        return true;
                    else {
                        for (const item of level.children.values()) {
                            if (checkChildren(item) === true)
                                return true;
                        }
                        return false;
                    }
                }
                return checkChildren(level);
            }
            else if (lrc === false) {
                return level.receivers.size > 0;
            }
            else {
                return level.receivers.has(lrc);
            }
        }
    }
}
exports.EventSpace = EventSpace;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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LEVBQUUsQ0FBQyxDQUFDLENBQUM7NEJBQ3pDLEVBQUUsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUM7Z0NBQzdCLE1BQU0sQ0FBQyxJQUFJLENBQUM7d0JBQ3BCLENBQUM7d0JBQ0QsTUFBTSxDQUFDLEtBQUssQ0FBQztvQkFDakIsQ0FBQztnQkFDTCxDQUFDO2dCQUVELE1BQU0sQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDaEMsQ0FBQztZQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDdkIsTUFBTSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQztZQUNwQyxDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ0osTUFBTSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3BDLENBQUM7UUFDTCxDQUFDO0lBQ0wsQ0FBQztDQUNKO0FBeEZELGdDQXdGQyIsImZpbGUiOiJjbGFzc2VzL0V2ZW50U3BhY2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFdmVudFNwYWNlVHlwZSB9IGZyb20gJy4vLi4vaW50ZXJmYWNlcy9FdmVudFNwYWNlVHlwZSc7XHJcbmltcG9ydCB7IEV2ZW50TGV2ZWwgfSBmcm9tIFwiLi9FdmVudExldmVsXCI7XHJcbmltcG9ydCB7IExpc3RlbmVyIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9MaXN0ZW5lclR5cGUnO1xyXG5cclxuZXhwb3J0IGNsYXNzIEV2ZW50U3BhY2UgaW1wbGVtZW50cyBFdmVudFNwYWNlVHlwZSB7XHJcbiAgICAvKipcclxuICAgICAqIOWwhuS6i+S7tuWQjei9rOaNouaIkOaVsOe7hOeahOW9ouW8j1xyXG4gICAgICogQHBhcmFtIGV2ZW50TmFtZSDkuovku7blkI3np7BcclxuICAgICAqL1xyXG4gICAgc3RhdGljIGNvbnZlcnRFdmVudE5hbWVUeXBlKGV2ZW50TmFtZTogc3RyaW5nIHwgc3RyaW5nW10pIHtcclxuICAgICAgICByZXR1cm4gJ3N0cmluZycgPT09IHR5cGVvZiBldmVudE5hbWUgPyBldmVudE5hbWUuc3BsaXQoJy4nKSA6IGV2ZW50TmFtZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9ldmVudExldmVsID0gbmV3IEV2ZW50TGV2ZWwoKTtcclxuXHJcbiAgICByZWNlaXZlID0gPFQgZXh0ZW5kcyBMaXN0ZW5lcj4oZXZlbnROYW1lOiBzdHJpbmcgfCBzdHJpbmdbXSwgbGlzdGVuZXI6IFQpID0+IHtcclxuICAgICAgICB0aGlzLl9ldmVudExldmVsXHJcbiAgICAgICAgICAgIC5nZXRDaGlsZChFdmVudFNwYWNlLmNvbnZlcnRFdmVudE5hbWVUeXBlKGV2ZW50TmFtZSksIHRydWUpXHJcbiAgICAgICAgICAgIC5yZWNlaXZlcnMuYWRkKGxpc3RlbmVyKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGxpc3RlbmVyO1xyXG4gICAgfVxyXG4gICAgb24gPSB0aGlzLnJlY2VpdmU7XHJcblxyXG4gICAgcmVjZWl2ZU9uY2UgPSA8VCBleHRlbmRzIExpc3RlbmVyPihldmVudE5hbWU6IHN0cmluZyB8IHN0cmluZ1tdLCBsaXN0ZW5lcjogVCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGxldmVsID0gdGhpcy5fZXZlbnRMZXZlbC5nZXRDaGlsZChFdmVudFNwYWNlLmNvbnZlcnRFdmVudE5hbWVUeXBlKGV2ZW50TmFtZSksIHRydWUpO1xyXG4gICAgICAgIGxldmVsLnJlY2VpdmVycy5hZGQoZnVuY3Rpb24gb25jZShkYXRhKSB7XHJcbiAgICAgICAgICAgIGxpc3RlbmVyKGRhdGEpO1xyXG4gICAgICAgICAgICBsZXZlbC5yZWNlaXZlcnMuZGVsZXRlKG9uY2UpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gbGlzdGVuZXI7XHJcbiAgICB9XHJcbiAgICBvbmNlID0gdGhpcy5yZWNlaXZlT25jZTtcclxuXHJcbiAgICBjYW5jZWwoZXZlbnROYW1lOiBzdHJpbmcgfCBzdHJpbmdbXSA9IFtdLCBscmM6IGJvb2xlYW4gfCBMaXN0ZW5lciA9IHRydWUpIHtcclxuICAgICAgICBjb25zdCBsZXZlbCA9IHRoaXMuX2V2ZW50TGV2ZWwuZ2V0Q2hpbGQoRXZlbnRTcGFjZS5jb252ZXJ0RXZlbnROYW1lVHlwZShldmVudE5hbWUpLCBmYWxzZSk7XHJcbiAgICAgICAgaWYgKGxldmVsICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgaWYgKGxyYyA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgbGV2ZWwucmVjZWl2ZXJzLmNsZWFyKCk7XHJcbiAgICAgICAgICAgICAgICBsZXZlbC5jaGlsZHJlbi5jbGVhcigpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGxyYyA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgICAgIGxldmVsLnJlY2VpdmVycy5jbGVhcigpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbGV2ZWwucmVjZWl2ZXJzLmRlbGV0ZShscmMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgb2ZmID0gdGhpcy5jYW5jZWw7XHJcblxyXG4gICAgdHJpZ2dlcihldmVudE5hbWU6IHN0cmluZyB8IHN0cmluZ1tdLCBkYXRhPzogYW55LCBpbmNsdWRlQ2hpbGRyZW46IGJvb2xlYW4gPSB0cnVlLCBhc3luY2hyb25vdXM/OiBib29sZWFuKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3QgbGV2ZWwgPSB0aGlzLl9ldmVudExldmVsLmdldENoaWxkKEV2ZW50U3BhY2UuY29udmVydEV2ZW50TmFtZVR5cGUoZXZlbnROYW1lKSwgZmFsc2UpO1xyXG4gICAgICAgIGlmIChsZXZlbCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIGxldmVsLnJlY2VpdmVycy5mb3JFYWNoKGl0ZW0gPT4gYXN5bmNocm9ub3VzID8gc2V0VGltZW91dChpdGVtLCAwLCBkYXRhKSA6IGl0ZW0oZGF0YSkpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKGluY2x1ZGVDaGlsZHJlbikge1xyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gdHJpZ2dlckNoaWxkcmVuKGxldmVsOiBFdmVudExldmVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV2ZWwucmVjZWl2ZXJzLmZvckVhY2goaXRlbSA9PiBhc3luY2hyb25vdXMgPyBzZXRUaW1lb3V0KGl0ZW0sIDAsIGRhdGEpIDogaXRlbShkYXRhKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV2ZWwuY2hpbGRyZW4uZm9yRWFjaCh0cmlnZ2VyQ2hpbGRyZW4pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbGV2ZWwuY2hpbGRyZW4uZm9yRWFjaCh0cmlnZ2VyQ2hpbGRyZW4pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgc2VuZCA9IHRoaXMudHJpZ2dlcjtcclxuXHJcbiAgICBoYXMoZXZlbnROYW1lOiBzdHJpbmcgfCBzdHJpbmdbXSwgbHJjOiBib29sZWFuIHwgTGlzdGVuZXIgPSB0cnVlKTogYm9vbGVhbiB7XHJcbiAgICAgICAgY29uc3QgbGV2ZWwgPSB0aGlzLl9ldmVudExldmVsLmdldENoaWxkKEV2ZW50U3BhY2UuY29udmVydEV2ZW50TmFtZVR5cGUoZXZlbnROYW1lKSwgZmFsc2UpO1xyXG4gICAgICAgIGlmIChsZXZlbCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAobHJjID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBjaGVja0NoaWxkcmVuKGxldmVsOiBFdmVudExldmVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxldmVsLnJlY2VpdmVycy5zaXplID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBsZXZlbC5jaGlsZHJlbi52YWx1ZXMoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoZWNrQ2hpbGRyZW4oaXRlbSkgPT09IHRydWUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY2hlY2tDaGlsZHJlbihsZXZlbCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobHJjID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGxldmVsLnJlY2VpdmVycy5zaXplID4gMDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBsZXZlbC5yZWNlaXZlcnMuaGFzKGxyYyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iXX0=
